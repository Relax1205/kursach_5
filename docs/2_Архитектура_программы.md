# 2. Архитектура программы

## 2.1. Общая архитектурная модель

Программа реализована на основе веб-фреймворка **Django** и использует архитектурный паттерн **MVT (Model-View-Template)** — адаптацию классического MVC (Model-View-Controller), принятую в экосистеме Django:

- **Model (Модель)** — отвечает за работу с данными и бизнес-логику на уровне объектов. Реализована в файлах `core/models.py`. Включает сущности: `Transaction` (транзакция), `Category` (категория), `Budget` (бюджет).
- **View (Представление)** — обрабатывает HTTP-запросы, координирует взаимодействие между моделью и шаблоном, возвращает HTTP-ответ. Реализована в `core/views.py` с использованием функциональных представлений и декоратора `@login_required`.
- **Template (Шаблон)** — отвечает за отображение данных в виде HTML. Шаблоны хранятся в `core/templates/core/` и используют наследование от базового шаблона `base.html`.

Такой подход обеспечивает чёткое разделение ответственности, упрощает сопровождение и тестирование кода.

## 2.2. Модульная структура проекта

Проект разделён на логически независимые приложения и модули:

- **`core`** — основное приложение, содержащее всю бизнес-логику:
  - `models.py` — определение моделей данных;
  - `views.py` — обработка запросов;
  - `forms.py` — валидация и отображение форм;
  - `services.py` — слой бизнес-логики (агрегации, импорт/экспорт);
  - `urls.py` — маршрутизация;
  - `templates/` — HTML-шаблоны;
  - `tests.py` — автоматизированные тесты.
- **`accounts`** — управление пользователями (авторизация, регистрация через встроенные механизмы Django).
- **`personal_finance/`** — конфигурационный пакет проекта (настройки, главные URL).

Такая структура соответствует принципу **DRY (Don’t Repeat Yourself)** и позволяет легко расширять функционал (например, добавить приложение `api` для мобильного клиента).

## 2.3. Использованные паттерны проектирования

В разработке применены следующие паттерны проектирования:

1. **Service Layer**  
   Бизнес-логика (расчёт сводок, импорт/экспорт CSV, сравнение с бюджетом) вынесена в отдельный модуль `services.py`. Это:
   - изолирует логику от представлений;
   - упрощает модульное тестирование;
   - позволяет повторно использовать функции в разных частях приложения.

2. **Front Controller**  
   Все HTTP-запросы обрабатываются централизованно через механизм маршрутизации Django (`urls.py`), что обеспечивает единый входной поток управления.

3. **Template Method**  
   Используется во встроенных механизмах Django (например, валидация форм через `clean_<field>()`), что позволяет гибко расширять поведение без изменения базового кода.

4. **Dependency Injection (упрощённая)**  
   Зависимости (например, текущий пользователь) передаются явно в формы и сервисы, что повышает тестируемость компонентов.

## 2.4. Гибкость и расширяемость

Архитектура программы спроектирована с учётом будущего развития:

- **Добавление новых типов операций** — достаточно расширить модель `Category`.
- **Поддержка валют** — можно добавить поле `currency` в `Transaction` и логику конвертации в `services.py`.
- **Мобильный API** — создание нового приложения `api` с использованием Django REST Framework.
- **Уведомления** — интеграция с Celery или email-рассылкой через сигналы Django.
- **Аналитика** — подключение библиотек вроде Pandas для прогнозирования бюджета.

Все изменения могут быть внесены без переписывания существующей логики благодаря чёткому разделению слоёв и соблюдению принципов SOLID.

## 2.5. Безопасность

- Все данные привязаны к авторизованному пользователю (`user=request.user`).
- Удаление транзакций требует подтверждения (HTTP POST + JavaScript-диалог).
- Используется CSRF-защита для всех форм.
- Пароли хранятся в хэшированном виде (стандартный механизм Django).

Таким образом, архитектура программы соответствует современным требованиям к веб-приложениям: она **модульна, тестируема, безопасна и легко расширяема**.